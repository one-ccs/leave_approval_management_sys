{% extends 'base.html' %}

{% block title %}
    管理员 - {{ rid }} {{ name }}
{% endblock title %}

{% block body %}
    <div class="container d-flex align-items-center" style="height: calc(100% - 62px);">
        <div class="itemcard">
            <div class="itemcard-menu">
                <ul class="pagination">
                    <li data-itemcard-menu="1" class="page-item active">
                        <button class="page-link"><i class="fa fa-address-card me-2"></i>用户信息</button>
                    </li>
                    <li data-itemcard-menu="2" class="page-item">
                        <button class="page-link"><i class="fa fa-sitemap me-2"></i>学生管理</button>
                    </li>
                    <li data-itemcard-menu="3" class="page-item">
                        <button class="page-link"><i class="fa fa-sitemap me-2"></i>教师管理</button>
                    </li>
                    <li data-itemcard-menu="4" class="page-item disabled">
                        <button class="page-link"><i class="fa fa-cogs"></i>设置</button>
                    </li>
                </ul>
            </div>
            <div data-itemcard-page="1" class="itemcard-page active">
                <div class="row h-100 flex-nowrap align-items-center justify-content-center">
                    <div class="col col-2 col-lg-2 col-sm-3">
                        <div class="card">
                            <img class=" card-body rounded" src="{{ url_for('static', filename='img/user.webp') }}" alt="user">
                            <div class="card-footer text-center">{{ name }}</div>
                        </div>
                    </div>
                    <table class="col col-8 table table-striped table-bordered m-0" border="3" style="width: 30%;background-color: #fff;">
                        <thead>
                            <tr><th colspan="2">管理员信息</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>ID</td><td>{{ aid }}</td></tr>
                            <tr><td>姓名</td><td>{{ name }}</td></tr>
                            <tr><td>性别</td><td>{{ gender }}</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div data-itemcard-page="2" class="itemcard-page">
                <div class="container">
                    <div class="row pb-2 mb-2" style="border-bottom: 1px solid black;">
                        <div class="col">
                            <button class="btn btn-danger" onclick="btnAdminDeleteStudentClick()">删除<i class="fa fa-trash-o ms-2"></i></button>
                        </div>
                        <div class="col d-flex justify-content-end">
                            <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#modifyStudentModal" onclick="btnModifyStudentClick(this)">修改<i class="fa fa-pencil-square-o ms-2"></i></button>
                            <button class="btn btn-primary ms-2" data-bs-toggle="modal" data-bs-target="#modifyStudentModal">添加<i class="fa fa-plus-circle ms-2"></i></button>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <table id="studentTable" class="col table table-hover table-bordered m-0 text-center" border="1" style="table-layout: fixed;">
                            <thead>
                                <tr><th>序号</th><th>学号</th><th>姓名</th><th>性别</th><th>学部</th><th>系别</th><th>专业</th><th>班级</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>
                            </tbody>
                        </table>
                        <div style="background-color: rgba(139, 191, 249, 0.5); border: 1px solid rgb(19, 98, 180); top: 124.5px; left: 356px; width: 0px; height: 0px; display: none; position: absolute; z-index: -999;"></div>
                    </div>
                </div>
            </div>
            <div data-itemcard-page="3" class="itemcard-page">
                <div class="container">
                    <div class="row pb-2 mb-2" style="border-bottom: 1px solid black;">
                        <div class="col">
                            <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#modifyTeacherModal" onclick="btnModifyStudentClick(this)">删除<i class="fa fa-trash-o ms-2"></i></button>
                        </div>
                        <div class="col d-flex justify-content-end">
                            <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#modifyTeacherModal" onclick="btnModifyStudentClick(this)">修改<i class="fa fa-pencil-square-o ms-2"></i></button>
                            <button class="btn btn-primary ms-2" data-bs-toggle="modal" data-bs-target="#modifyTeacherModal">添加<i class="fa fa-plus-circle ms-2"></i></button>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <table id="teacherTable" class="col table table-hover table-bordered m-0 text-center" border="1" style="table-layout: fixed;">
                            <thead>
                                <tr><th>序号</th><th>ID</th><th>姓名</th><th>性别</th><th>电话号码</th><th>职能</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div data-itemcard-page="4" class="itemcard-page">
                设置
            </div>
        </div>
    </div>

    <div class="modal fade" id="modifyStudentModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">修改学生信息</div>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="modifyStudentForm" class="container rounded mx-auto">
                        <div class="row">
                            <div class="col">
                                <div class="form-floating">
                                    <input class="form-control" type="text" name="sid">
                                    <label class="form-label float-start" for="sid">学号</label>
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-floating">
                                    <input class="form-control" type="text" name="name">
                                    <label class="form-label" for="name">姓名</label>
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-floating">
                                    <input class="form-control" type="text" name="gender">
                                    <label class="form-label" for="gender">性别</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-floating mt-3">
                            <input class="form-control" type="text" name="department">
                            <label class="form-label" for="department">学部</label>
                        </div>
                        <div class="form-floating mt-3">
                            <input class="form-control" type="text" name="faculty">
                            <label class="form-label" for="faculty">系别</label>
                        </div>
                        <div class="form-floating mt-3">
                            <input class="form-control" type="text" name="major">
                            <label class="form-label" for="major">专业</label>
                        </div>
                        <div class="form-floating mt-3">
                            <input class="form-control" type="text" name="class">
                            <label class="form-label" for="class">班级</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" data-bs-dismiss="modal">关闭</button>
                    <button class="btn btn-primary" onclick="btnModifyStudentSubmitClick()">提交</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="modifyTeacherModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">修改教师信息</div>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="modifyTeacherForm" class="container rounded mx-auto">
                        <div class="row">
                            <div class="col">
                                <div class="form-floating mt-3">
                                    <input class="form-control" type="text" name="tid">
                                    <label class="form-label" for="tid">ID</label>
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-floating mt-3">
                                    <input class="form-control" type="text" name="name">
                                    <label class="form-label" for="name">姓名</label>
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-floating mt-3">
                                    <input class="form-control" type="text" name="gender">
                                    <label class="form-label" for="gender">性别</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-floating mt-3">
                            <input class="form-control" type="text" name="telphone">
                            <label class="form-label" for="telphone">电话号码</label>
                        </div>
                        <div class="form-floating mt-3">
                            <input class="form-control" type="text" name="role">
                            <label class="form-label" for="role">职能</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" data-bs-dismiss="modal">关闭</button>
                    <button class="btn btn-primary" onclick="btnModifyTeacherSubmitClick()">提交</button>
                </div>
            </div>
        </div>
    </div>
{% endblock body %}

{% block script %}
    <script>
        let studentTable = teacherTable = null;
        $.fn.dataTable.ext.errMode = 'throw';
        $('[data-itemcard-menu="2"]').on('click', () => {
            if(studentTable) return;
            studentTable = $('#studentTable').dataTable({
                processing: true,
                stateSave: true,
                language: {
                    url: '/static/localisation/zh_CN.json'
                },
                columns: [
                    {'data': 'on'},
                    {'data': 'sid'},
                    {'data': 'name'},
                    {'data': 'gender'},
                    {'data': 'department'},
                    {'data': 'faculty'},
                    {'data': 'major'},
                    {'data': 'class'},
                ],
                columnDefs: [
                    {'width': '5%', 'targets': 0},
                    {'width': '10%', 'targets': 1},
                    {'width': '6%', 'targets': 2},
                    {'width': '5%', 'targets': 3},
                    {'width': '16%', 'targets': 4},
                    {'width': '25%', 'targets': 5},
                    {'width': '23%', 'targets': 6},
                    {'width': '5%', 'targets': 7},
                ],
                ajax: '/admin/students'
            });
        });
        $('[data-itemcard-menu="3"]').on('click', () => {
            if(teacherTable)  return;
            teacherTable = $('#teacherTable').dataTable({
                "processing": true,
                "stateSave": true,
                language: {
                    url: '/static/localisation/zh_CN.json'
                },
                columns: [
                    {'data': 'on'},
                    {'data': 'tid'},
                    {'data': 'name'},
                    {'data': 'gender'},
                    {'data': 'telphone'},
                    {'data': 'role'},
                ],
                columnDefs: [
                    {'width': '5%', 'targets': 0},
                ],
                ajax: '/admin/teachers'
            });
        });
    </script>
{% endblock %}
