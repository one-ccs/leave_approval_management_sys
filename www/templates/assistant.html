{% extends 'base.html' %}

{% block title %}
    辅导员 - {{ rid }} {{ name }}_电气信息学院请假管理系统
{% endblock title %}

{% block body %}
    <div class="container-fluid d-flex align-items-center" style="width: 88%;height: calc(100% - 62px);">
        <div class="itemcard">
            <div class="itemcard-menu">
                <ul class="pagination">
                    <li data-itemcard-menu="1" class="page-item active"><button class="page-link"><i class="fa fa-address-card me-2"></i>用户信息</button></li>
                    <li data-itemcard-menu="2" class="page-item"><button class="page-link"><i class="fa fa-plus-square me-2"></i>审批</button></li>
                    <li data-itemcard-menu="3" class="page-item disabled"><button class="page-link"><i class="fa fa-cogs me-2"></i>设置</button></li>
                </ul>
            </div>
            <div data-itemcard-page="1" class="itemcard-page active">
                <div class="row h-100 flex-nowrap align-items-center justify-content-center">
                    <div class="col col-2 col-lg-2 col-sm-3">
                        <div class="card">
                            <img class=" card-body rounded" src="{{ url_for('static', filename='img/user.webp') }}" alt="user">
                            <div class="card-footer text-center">{{ name }}</div>
                        </div>
                    </div>
                    <table class="col col-8 table table-striped table-bordered m-0" border="3" style="width: 66%;background-color: #fff;">
                        <thead>
                            <tr><th colspan="4">辅导员信息</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>ID</td><td>{{ tid }}</td></tr>
                            <tr><td>姓名</td><td>{{ name }}</td></tr>
                            <tr><td>性别</td><td>{{ gender }}</td></tr>
                            <tr><td>电话号码</td><td>{{ telphone }}</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div data-itemcard-page="2" class="itemcard-page">
                <div class="container-fluid">
                    <div class="row pb-2 mb-2" style="border-bottom: 1px solid black;">
                        <div class="col">
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addFormModal">新建申请<i class="fa fa-plus-circle ms-2"></i></button>
                        </div>
                    </div>
                    <table id="table1" class="table table-striped table-bordered text-center mt-2" style="table-layout: fixed;">
                        <thead>
                            <tr><th>编号</th><th>申请日期</th><th>类别</th><th>开始日期</th><th>结束日期</th><th>原因</th><th>辅导员</th><th>教务处</th><th>状态</th><th>操作</th></tr>
                        </thead>
                        <tbody id="leaveList">
                            <tr><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td><button class="btn btn-danger btn-sm me-1 disabled"><i class="fa fa-eye"></i></button></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div data-itemcard-page="3" class="itemcard-page">
                设置
            </div>
        </div>
    </div>
{% endblock body %}

{% block script %}
    <script>
        let table1 = null;
        $.fn.dataTable.ext.errMode = 'throw';
        $('[data-itemcard-menu="2"]').on('click', () => {
            if(!table1) {
                table1 = $('#table1').dataTable({
                    processing: true,
                    stateSave: true,
                    language: {
                        url: '/static/localisation/zh_CN.json'
                    },
                    columns: [
                        {'data': 'id'},
                        {'data': 'apply_datetime'},
                        {'data': 'category'},
                        {'data': 'start_datetime'},
                        {'data': 'end_datetime'},
                        {'data': 'reason'},
                        {'data': 'a1'},
                        {'data': 'a2'},
                        {'data': 'state'},
                        {'data': 'action'},
                    ],
                    columnDefs: [
                        {'width': '5%', 'targets': 0},
                        {'width': '15%', 'targets': 1},
                        {'width': '6%', 'targets': 2},
                        {'width': '15%', 'targets': 3},
                        {'width': '15%', 'targets': 4},
                        {'width': '25%', 'targets': 5},
                        {'width': '6%', 'targets': 6},
                        {'width': '6%', 'targets': 7},
                        {'width': '6%', 'targets': 8},
                        {'width': '5%', 'targets': 9},
                    ],
                    ajax: '/assistant/leaves',
                });
            }
            else {
                table1.api().ajax.reload();
            }
        });
    </script>
{% endblock %}
